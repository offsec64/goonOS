<!DOCTYPE html>
<html lang="en">

    <head>
        <title>GoonOS Alpha 1</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/goonStyles.css') }}">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Racing+Sans+One&display=swap" rel="stylesheet">
    </head>

    <body>
        <div id="menubar">
            <a id="logo">GoonOS Gateway</a>
            <a class="accent-text">Alpha 1.1 RC1</a>
            <div class="flexspacer"></div>

        </div>

        <!-- Main Window -->
        <div id="pagestructure">
            <div id="pagelist">
                <!--Content will be automatically added according to applets.json-->
            </div>
            <iframe src="{{ url_for('appletsindex') }}" class="applet" id="applet-iframe"></iframe>
        </div>

        <div id="footer">
            <a>Pre-release software. Do not distribute!</a>
            <div class="flexspacer"></div>
            <a>v1 Alpha</a>
        </div>
        
    </body>

    <!--add custom right click menu-->


    <!--very fake loading screen-->
    <div id="pagecover">
        <div class="flexspacer"></div>
        <div id="loading">
            <a id="logo">GoonOS Gateway</a>
            <a id="loadtext">Loading.... Procuring Dependencies</a>
            <div class="flexspacer"></div>
            <a>v1 Alpha</a>
        </div>
        <div class="flexspacer"></div>
    </div>

    <script>

        /*alright so what i thing im going to do is for the applet list is:
            - load the contents of the json into an array
            - build the elements based off array data
            - append to applet list

        why did you code it like you did simon :( 
        
        -jd
        */

        const routes = {
            botmanagement: {
                url: "{{ url_for('botmanagement') }}",
                name: "Bot Management"
            },
            chat: {
                url: "{{ url_for('chat') }}",
                name: "Chat"
            },
            steamstats: {
                url: "{{ url_for('steamstats') }}",
                name: "Steam Stats"
            }
        };

        const element = document.getElementById("pagelist");

        for (const key in routes) {
            let item = document.createElement('a')
            item.classList.add("pagelist_item");
            item.id = "applet-" + key ;
            item.innerHTML = routes[key].name;
            item.setAttribute("onclick", `loadIframe('${key}')` );

            element.appendChild(item);
        }
        
        function loadIframe(routeName) {
            const iframe = document.getElementById("applet-iframe");
            iframe.src = routes[routeName].url;
        }


        //let numapplets = 1;
        //let jsondata;   

        /*
        fetch("{{ url_for('static', filename='json/applets.json') }}")
            .then(function(u) {
                return u.json();
            })
            .then(function(json) {
                let id = 0;
                jsondata = json;
                for (const [key, value] of Object.entries(jsondata["applets"])) {
                    let data = (key, value);
                    const item = document.createElement("a");
                    item.classList.add("pagelist_item");
                    item.id = "appletid" + id;
                    item.innerHTML = data["Name"];

                    item.setAttribute("onclick",`loadApplet(, ${id})`);
                    

                    const element = document.getElementById("pagelist");
                    element.appendChild(item);
                    id++;
                }
                numapplets=id;
            })
            .catch(function(error) {
                console.error('Error fetching or parsing JSON:', error);
            });
        */
       

        // -- working code --

        /*
        const item = document.createElement("a");
        item.classList.add("pagelist_item");
        item.id = "appletid" + 1;
        item.innerHTML = "Chat";

        //item.setAttribute("onclick", loadApplet())

        const element = document.getElementById("pagelist");
        element.appendChild(item);

        item.setAttribute("onclick", document.getElementById("applet_embed").src = "{{ url_for('chat') }}");
        */

        // -------------------

        //loadApplet("/chat.html", 1)

        /*
        function loadApplet(name, id) {

            for (let step = 0; step < numapplets; step++) {

                var listitem = document.getElementById("appletid" + step);
                listitem.classList.remove("active");

            }

            document.getElementById("applet_embed").src = "/chat.html";

            var listitem = document.getElementById("appletid" + 1);

            listitem.className = listitem.className + ' active';
        }
        */


        // fake loading screen
        setTimeout(() => {
            var x = document.getElementById("loadtext").innerHTML = "Loading.... Recompiling Linux Kernal";
        }, 1300);

        setTimeout(() => {
            var x = document.getElementById("loadtext").innerHTML = "Loading.... Synergizing and Streamlining";
        }, 3000);

        setTimeout(() => {
            var x = document.getElementById("pagecover");x.style.display = "none";
        }, 4000);
    </script>

</html>
